<div class="card">
  {{#Furigana}}
    <div class="expression-wrapper">
      <h2 class="expression plain-expression tappable" onclick="playAudio('audio_expression')">
        {{Expression}}
      </h2>
      <h2 class="expression furigana-expression tappable is-hidden" onclick="playAudio('audio_expression')">
        {{Furigana}}
      </h2>
    </div>
  {{/Furigana}}
  {{^Furigana}}
    <h2 class="expression expression-no-furigana tappable" onclick="playAudio('audio_expression')">
      {{Expression}}
    </h2>
  {{/Furigana}}

  {{#ExpressionAudio}}
    <div id="audio_expression" hidden>{{ExpressionAudio}}</div>
  {{/ExpressionAudio}}

  <hr>

  <p><strong>{{Meaning}}</strong></p>
  {{^Furigana}}
    <p><strong>Reading:</strong> {{Reading}}</p>
  {{/Furigana}}

  {{#Sentence}}
  <hr>
  <div class="sentence-wrapper">
    <p class="sentence plain-sentence tappable preline" onclick="playAudio('audio_sentence')">
      {{Sentence}}
    </p>
    {{#SentenceFurigana}}
      <p class="sentence furigana-sentence tappable preline is-hidden" onclick="playAudio('audio_sentence')">
        {{SentenceFurigana}}
      </p>
    {{/SentenceFurigana}}
    {{^SentenceFurigana}}
      {{#SentenceKana}}
        <p class="sentence kana-sentence tappable preline is-hidden" onclick="playAudio('audio_sentence')">
          {{SentenceKana}}
        </p>
      {{/SentenceKana}}
    {{/SentenceFurigana}}
  </div>
  {{#SentenceAudio}}
    <div id="audio_sentence" hidden>{{SentenceAudio}}</div>
  {{/SentenceAudio}}
{{/Sentence}}

  {{#SentenceTranslation}}
    <p class="preline">{{SentenceTranslation}}</p>
  {{/SentenceTranslation}}

  {{#Note}}
    <div style="border-top: 2px solid; margin-top: 15px; padding-top: 10px; text-align: left;">
      <b>Note:</b> {{Note}}
    </div>
  {{/Note}}

  {{#ImageURI}}
    <img src="{{ImageURI}}" alt="Image for {{Expression}}">
  {{/ImageURI}}

  {{#Furigana}}
    <div style="text-align: center; margin-top: 15px;">
      <button type="button" onclick="toggleFurigana()" title="Toggle furigana">Toggle Furigana</button>
    </div>
  {{/Furigana}}
  {{^Furigana}}
    {{#SentenceKana}}
      <div style="text-align: center; margin-top: 15px;">
        <button type="button" onclick="toggleFurigana()" title="Toggle kana">Toggle Kana</button>
      </div>
    {{/SentenceKana}}
  {{/Furigana}}
</div>

<script>
  function playAudio(id) {
    const audioElement = document.getElementById(id);
    if (audioElement) {
      audioElement.querySelector(".replay-button, .replaybutton").click();
    }
  }

  function toggleFurigana() {
    const plainExpression = document.querySelector('.plain-expression');
    const furiganaExpression = document.querySelector('.furigana-expression');
    const plainSentence = document.querySelector('.plain-sentence');
    const furiganaSentence = document.querySelector('.furigana-sentence');
    const kanaSentence = document.querySelector('.kana-sentence');

    // Expression-Furigana Toggle
    if (plainExpression && furiganaExpression) {
      if (furiganaExpression.classList.contains('is-hidden')) {
        furiganaExpression.classList.remove('is-hidden');
        plainExpression.classList.add('is-hidden');
      } else {
        furiganaExpression.classList.add('is-hidden');
        plainExpression.classList.remove('is-hidden');
      }
    }

    // Sentence Toggle (Furigana oder Kana)
    if (plainSentence) {
      if (furiganaSentence && furiganaSentence.classList.contains('is-hidden')) {
        furiganaSentence.classList.remove('is-hidden');
        plainSentence.classList.add('is-hidden');
        if (kanaSentence) kanaSentence.classList.add('is-hidden'); // Kana verstecken
      } else if (furiganaSentence && !furiganaSentence.classList.contains('is-hidden')) {
        furiganaSentence.classList.add('is-hidden');
        plainSentence.classList.remove('is-hidden');
        if (kanaSentence) kanaSentence.classList.remove('is-hidden'); // Kana wieder anzeigen
      } else if (!furiganaSentence && kanaSentence) {
        // Falls es KEIN Furigana gibt, nur Kana toggeln
        if (kanaSentence.classList.contains('is-hidden')) {
          kanaSentence.classList.remove('is-hidden');
          plainSentence.classList.add('is-hidden');
        } else {
          kanaSentence.classList.add('is-hidden');
          plainSentence.classList.remove('is-hidden');
        }
      }
    }
}

</script>
